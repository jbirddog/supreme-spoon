
from SpiffWorkflow.bpmn.serializer.workflow import BpmnWorkflowSerializer
from SpiffWorkflow.bpmn.workflow import BpmnWorkflow
from SpiffWorkflow.spiff.parser.process import SpiffBpmnParser
from SpiffWorkflow.spiff.serializer.task_spec_converters import ScriptTaskConverter
from SpiffWorkflow.task import TaskState


SERIALIZER_VERSION = "1.0-supreme-spoon"
wf_spec_converter = BpmnWorkflowSerializer.configure_workflow_spec_converter(
    [
        ScriptTaskConverter,
    ]
)
serializer = BpmnWorkflowSerializer(wf_spec_converter, version=SERIALIZER_VERSION)
serialized = {'data': {}, 'last_task': None, 'success': True, 'tasks': {'3847702b-8e69-4201-8df1-60660e8c56b5': {'id': '3847702b-8e69-4201-8df1-60660e8c56b5', 'parent': None, 'children': ['443e0d28-4cfb-4f9a-b7f0-9708d0c3ff2a'], 'last_state_change': 1668726536.9588475, 'state': 32, 'task_spec': 'Root', 'triggered': False, 'workflow_name': 'Proccess_v60ufvy', 'internal_data': {}, 'data': {}}, '443e0d28-4cfb-4f9a-b7f0-9708d0c3ff2a': {'id': '443e0d28-4cfb-4f9a-b7f0-9708d0c3ff2a', 'parent': '3847702b-8e69-4201-8df1-60660e8c56b5', 'children': ['7d1f1d76-f292-4f9a-808e-fcd1811f9137'], 'last_state_change': 1668726536.9589653, 'state': 16, 'task_spec': 'Start', 'triggered': False, 'workflow_name': 'Proccess_v60ufvy', 'internal_data': {}, 'data': {}}, '7d1f1d76-f292-4f9a-808e-fcd1811f9137': {'id': '7d1f1d76-f292-4f9a-808e-fcd1811f9137', 'parent': '443e0d28-4cfb-4f9a-b7f0-9708d0c3ff2a', 'children': ['f22e42af-31ec-495d-965a-80e616fc2055'], 'last_state_change': 1668726536.9588723, 'state': 4, 'task_spec': 'StartEvent_1', 'triggered': False, 'workflow_name': 'Proccess_v60ufvy', 'internal_data': {}, 'data': {}}, 'f22e42af-31ec-495d-965a-80e616fc2055': {'id': 'f22e42af-31ec-495d-965a-80e616fc2055', 'parent': '7d1f1d76-f292-4f9a-808e-fcd1811f9137', 'children': ['cd9f2cfc-fd22-4b6d-8ea3-0775d8a962b1'], 'last_state_change': 1668726536.958889, 'state': 4, 'task_spec': 'Activity_0dhi288', 'triggered': False, 'workflow_name': 'Proccess_v60ufvy', 'internal_data': {}, 'data': {}}, 'cd9f2cfc-fd22-4b6d-8ea3-0775d8a962b1': {'id': 'cd9f2cfc-fd22-4b6d-8ea3-0775d8a962b1', 'parent': 'f22e42af-31ec-495d-965a-80e616fc2055', 'children': ['8d1dab05-0a78-49d3-b4fe-441dbf28621e'], 'last_state_change': 1668726536.9589055, 'state': 4, 'task_spec': 'Event_0ggcklt', 'triggered': False, 'workflow_name': 'Proccess_v60ufvy', 'internal_data': {}, 'data': {}}, '8d1dab05-0a78-49d3-b4fe-441dbf28621e': {'id': '8d1dab05-0a78-49d3-b4fe-441dbf28621e', 'parent': 'cd9f2cfc-fd22-4b6d-8ea3-0775d8a962b1', 'children': ['0dbbbb04-eaca-467f-a609-4e7b1228ece6'], 'last_state_change': 1668726536.9589167, 'state': 4, 'task_spec': 'Proccess_v60ufvy.EndJoin', 'triggered': False, 'workflow_name': 'Proccess_v60ufvy', 'internal_data': {}, 'data': {}}, '0dbbbb04-eaca-467f-a609-4e7b1228ece6': {'id': '0dbbbb04-eaca-467f-a609-4e7b1228ece6', 'parent': '8d1dab05-0a78-49d3-b4fe-441dbf28621e', 'children': [], 'last_state_change': 1668726536.9589274, 'state': 4, 'task_spec': 'End', 'triggered': False, 'workflow_name': 'Proccess_v60ufvy', 'internal_data': {}, 'data': {}}}, 'root': '3847702b-8e69-4201-8df1-60660e8c56b5', 'spec': {'name': 'Proccess_v60ufvy', 'description': 'Proccess_v60ufvy', 'file': 'supreme_spoon/bpmn/spoon.bpmn', 'task_specs': {'Start': {'id': 'Proccess_v60ufvy_1', 'name': 'Start', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': ['StartEvent_1'], 'typename': 'StartTask'}, 'Proccess_v60ufvy.EndJoin': {'id': 'Proccess_v60ufvy_2', 'name': 'Proccess_v60ufvy.EndJoin', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Event_0ggcklt'], 'outputs': ['End'], 'typename': '_EndJoin'}, 'End': {'id': 'Proccess_v60ufvy_3', 'name': 'End', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Proccess_v60ufvy.EndJoin'], 'outputs': [], 'typename': 'Simple'}, 'StartEvent_1': {'id': 'Proccess_v60ufvy_4', 'name': 'StartEvent_1', 'description': 'CmdStart', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Start'], 'outputs': ['Activity_0dhi288'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 179.0, 'y': 159.0}, 'outgoing_sequence_flows': {'Activity_0dhi288': {'id': 'Flow_04cfqkp', 'name': None, 'documentation': None, 'target_task_spec': 'Activity_0dhi288', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'Flow_04cfqkp': {'id': 'Flow_04cfqkp', 'name': None, 'documentation': None, 'target_task_spec': 'Activity_0dhi288', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'StartEvent', 'extensions': {}}, 'Activity_0dhi288': {'id': 'Proccess_v60ufvy_5', 'name': 'Activity_0dhi288', 'description': 'ParseCmdArgs', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['StartEvent_1'], 'outputs': ['Event_0ggcklt'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 270.0, 'y': 137.0}, 'outgoing_sequence_flows': {'Event_0ggcklt': {'id': 'Flow_0kvp7gd', 'name': None, 'documentation': None, 'target_task_spec': 'Event_0ggcklt', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'Flow_0kvp7gd': {'id': 'Flow_0kvp7gd', 'name': None, 'documentation': None, 'target_task_spec': 'Event_0ggcklt', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'prescript': None, 'postscript': None, 'script': 'import argparse', 'typename': 'ScriptTask', 'extensions': {}}, 'Event_0ggcklt': {'id': 'Proccess_v60ufvy_6', 'name': 'Event_0ggcklt', 'description': None, 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Activity_0dhi288'], 'outputs': ['Proccess_v60ufvy.EndJoin'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 432.0, 'y': 159.0}, 'outgoing_sequence_flows': {'Proccess_v60ufvy.EndJoin': {'id': 'Event_0ggcklt.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'Proccess_v60ufvy.EndJoin', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'Event_0ggcklt.ToEndJoin': {'id': 'Event_0ggcklt.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'Proccess_v60ufvy.EndJoin', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'EndEvent', 'extensions': {}}, 'Root': {'id': 'Proccess_v60ufvy_7', 'name': 'Root', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': [], 'typename': 'Simple'}}, 'data_inputs': [], 'data_outputs': [], 'data_objects': {}, 'correlation_keys': {}, 'typename': 'BpmnProcessSpec'}, 'subprocess_specs': {'Proccess_v60ufvy': {'name': 'Proccess_v60ufvy', 'description': 'Proccess_v60ufvy', 'file': 'supreme_spoon/bpmn/spoon.bpmn', 'task_specs': {'Start': {'id': 'Proccess_v60ufvy_1', 'name': 'Start', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': ['StartEvent_1'], 'typename': 'StartTask'}, 'Proccess_v60ufvy.EndJoin': {'id': 'Proccess_v60ufvy_2', 'name': 'Proccess_v60ufvy.EndJoin', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Event_0ggcklt'], 'outputs': ['End'], 'typename': '_EndJoin'}, 'End': {'id': 'Proccess_v60ufvy_3', 'name': 'End', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Proccess_v60ufvy.EndJoin'], 'outputs': [], 'typename': 'Simple'}, 'StartEvent_1': {'id': 'Proccess_v60ufvy_4', 'name': 'StartEvent_1', 'description': 'CmdStart', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Start'], 'outputs': ['Activity_0dhi288'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 179.0, 'y': 159.0}, 'outgoing_sequence_flows': {'Activity_0dhi288': {'id': 'Flow_04cfqkp', 'name': None, 'documentation': None, 'target_task_spec': 'Activity_0dhi288', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'Flow_04cfqkp': {'id': 'Flow_04cfqkp', 'name': None, 'documentation': None, 'target_task_spec': 'Activity_0dhi288', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'StartEvent', 'extensions': {}}, 'Activity_0dhi288': {'id': 'Proccess_v60ufvy_5', 'name': 'Activity_0dhi288', 'description': 'ParseCmdArgs', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['StartEvent_1'], 'outputs': ['Event_0ggcklt'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 270.0, 'y': 137.0}, 'outgoing_sequence_flows': {'Event_0ggcklt': {'id': 'Flow_0kvp7gd', 'name': None, 'documentation': None, 'target_task_spec': 'Event_0ggcklt', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'Flow_0kvp7gd': {'id': 'Flow_0kvp7gd', 'name': None, 'documentation': None, 'target_task_spec': 'Event_0ggcklt', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'prescript': None, 'postscript': None, 'script': 'import argparse', 'typename': 'ScriptTask', 'extensions': {}}, 'Event_0ggcklt': {'id': 'Proccess_v60ufvy_6', 'name': 'Event_0ggcklt', 'description': None, 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Activity_0dhi288'], 'outputs': ['Proccess_v60ufvy.EndJoin'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 432.0, 'y': 159.0}, 'outgoing_sequence_flows': {'Proccess_v60ufvy.EndJoin': {'id': 'Event_0ggcklt.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'Proccess_v60ufvy.EndJoin', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'Event_0ggcklt.ToEndJoin': {'id': 'Event_0ggcklt.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'Proccess_v60ufvy.EndJoin', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'EndEvent', 'extensions': {}}, 'Root': {'id': 'Proccess_v60ufvy_7', 'name': 'Root', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': [], 'typename': 'Simple'}}, 'data_inputs': [], 'data_outputs': [], 'data_objects': {}, 'correlation_keys': {}, 'typename': 'BpmnProcessSpec'}}, 'subprocesses': {}, 'bpmn_messages': []}

wf = serializer.workflow_from_dict(serialized)
wf.do_engine_steps()
print(wf.data)
