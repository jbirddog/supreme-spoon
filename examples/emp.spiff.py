
from SpiffWorkflow.bpmn.workflow import BpmnWorkflow
from SpiffWorkflow.spiff.parser.process import SpiffBpmnParser
from SpiffWorkflow.task import TaskState

from SpiffWorkflow.dmn.serializer.task_spec_converters import BusinessRuleTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import BoundaryEventConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import CallActivityTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import EndEventConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import IntermediateCatchEventConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import IntermediateThrowEventConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import ManualTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import NoneTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import ReceiveTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import ScriptTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import SendTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import ServiceTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import StartEventConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import SubWorkflowTaskConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import TransactionSubprocessConverter
from SpiffWorkflow.spiff.serializer.task_spec_converters import UserTaskConverter

from SpiffWorkflow.bpmn.serializer.workflow import BpmnWorkflowSerializer

SERIALIZER_VERSION = "1.0-supreme-spoon"
wf_spec_converter = BpmnWorkflowSerializer.configure_workflow_spec_converter(
    [
        BoundaryEventConverter,
        BusinessRuleTaskConverter,
        CallActivityTaskConverter,
        EndEventConverter,
        IntermediateCatchEventConverter,
        IntermediateThrowEventConverter,
        ManualTaskConverter,
        NoneTaskConverter,
        ReceiveTaskConverter,
        ScriptTaskConverter,
        SendTaskConverter,
        ServiceTaskConverter,
        StartEventConverter,
        SubWorkflowTaskConverter,
        TransactionSubprocessConverter,
        UserTaskConverter,
    ]
)
serializer = BpmnWorkflowSerializer(wf_spec_converter, version=SERIALIZER_VERSION)
serialized = {'data': {}, 'last_task': None, 'success': True, 'tasks': {'ea10cbfa-8e42-4f33-ae71-8d04ca21e65c': {'id': 'ea10cbfa-8e42-4f33-ae71-8d04ca21e65c', 'parent': None, 'children': ['c01a1186-709c-4b1a-992e-944bde111eca'], 'last_state_change': 1667418155.7296436, 'state': 32, 'task_spec': 'Root', 'triggered': False, 'workflow_name': 'empty_workflow', 'internal_data': {}, 'data': {}}, 'c01a1186-709c-4b1a-992e-944bde111eca': {'id': 'c01a1186-709c-4b1a-992e-944bde111eca', 'parent': 'ea10cbfa-8e42-4f33-ae71-8d04ca21e65c', 'children': ['50c88983-d7c3-4be4-8cde-9a8af770cdb2'], 'last_state_change': 1667418155.7297983, 'state': 16, 'task_spec': 'Start', 'triggered': False, 'workflow_name': 'empty_workflow', 'internal_data': {}, 'data': {}}, '50c88983-d7c3-4be4-8cde-9a8af770cdb2': {'id': '50c88983-d7c3-4be4-8cde-9a8af770cdb2', 'parent': 'c01a1186-709c-4b1a-992e-944bde111eca', 'children': ['add9824b-6aff-49b7-8c82-281d4f351dac'], 'last_state_change': 1667418155.7296784, 'state': 4, 'task_spec': 'StartEvent_1', 'triggered': False, 'workflow_name': 'empty_workflow', 'internal_data': {}, 'data': {}}, 'add9824b-6aff-49b7-8c82-281d4f351dac': {'id': 'add9824b-6aff-49b7-8c82-281d4f351dac', 'parent': '50c88983-d7c3-4be4-8cde-9a8af770cdb2', 'children': ['e4bd3eed-a8f5-4f8b-89c8-a94b0aed0af5'], 'last_state_change': 1667418155.7296917, 'state': 4, 'task_spec': 'EndEvent_0q4qzl9', 'triggered': False, 'workflow_name': 'empty_workflow', 'internal_data': {}, 'data': {}}, 'e4bd3eed-a8f5-4f8b-89c8-a94b0aed0af5': {'id': 'e4bd3eed-a8f5-4f8b-89c8-a94b0aed0af5', 'parent': 'add9824b-6aff-49b7-8c82-281d4f351dac', 'children': ['168679a9-ae44-4377-8229-605f6c7bc8ea'], 'last_state_change': 1667418155.729706, 'state': 4, 'task_spec': 'empty_workflow.EndJoin', 'triggered': False, 'workflow_name': 'empty_workflow', 'internal_data': {}, 'data': {}}, '168679a9-ae44-4377-8229-605f6c7bc8ea': {'id': '168679a9-ae44-4377-8229-605f6c7bc8ea', 'parent': 'e4bd3eed-a8f5-4f8b-89c8-a94b0aed0af5', 'children': [], 'last_state_change': 1667418155.7297184, 'state': 4, 'task_spec': 'End', 'triggered': False, 'workflow_name': 'empty_workflow', 'internal_data': {}, 'data': {}}}, 'root': 'ea10cbfa-8e42-4f33-ae71-8d04ca21e65c', 'spec': {'name': 'empty_workflow', 'description': 'empty_workflow', 'file': 'examples/emp.bpmn', 'task_specs': {'Start': {'id': 'empty_workflow_1', 'name': 'Start', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': ['StartEvent_1'], 'typename': 'StartTask'}, 'empty_workflow.EndJoin': {'id': 'empty_workflow_2', 'name': 'empty_workflow.EndJoin', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['EndEvent_0q4qzl9'], 'outputs': ['End'], 'typename': '_EndJoin'}, 'End': {'id': 'empty_workflow_3', 'name': 'End', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['empty_workflow.EndJoin'], 'outputs': [], 'typename': 'Simple'}, 'StartEvent_1': {'id': 'empty_workflow_4', 'name': 'StartEvent_1', 'description': None, 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Start'], 'outputs': ['EndEvent_0q4qzl9'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 179.0, 'y': 99.0}, 'outgoing_sequence_flows': {'EndEvent_0q4qzl9': {'id': 'SequenceFlow_0lvudp8', 'name': None, 'documentation': None, 'target_task_spec': 'EndEvent_0q4qzl9', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'SequenceFlow_0lvudp8': {'id': 'SequenceFlow_0lvudp8', 'name': None, 'documentation': None, 'target_task_spec': 'EndEvent_0q4qzl9', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'StartEvent', 'extensions': {}}, 'EndEvent_0q4qzl9': {'id': 'empty_workflow_5', 'name': 'EndEvent_0q4qzl9', 'description': None, 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['StartEvent_1'], 'outputs': ['empty_workflow.EndJoin'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 432.0, 'y': 99.0}, 'outgoing_sequence_flows': {'empty_workflow.EndJoin': {'id': 'EndEvent_0q4qzl9.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'empty_workflow.EndJoin', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'EndEvent_0q4qzl9.ToEndJoin': {'id': 'EndEvent_0q4qzl9.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'empty_workflow.EndJoin', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'EndEvent', 'extensions': {}}, 'Root': {'id': 'empty_workflow_6', 'name': 'Root', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': [], 'typename': 'Simple'}}, 'data_inputs': [], 'data_outputs': [], 'data_objects': {}, 'correlation_keys': {}, 'typename': 'BpmnProcessSpec'}, 'subprocess_specs': {'empty_workflow': {'name': 'empty_workflow', 'description': 'empty_workflow', 'file': 'examples/emp.bpmn', 'task_specs': {'Start': {'id': 'empty_workflow_1', 'name': 'Start', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': ['StartEvent_1'], 'typename': 'StartTask'}, 'empty_workflow.EndJoin': {'id': 'empty_workflow_2', 'name': 'empty_workflow.EndJoin', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['EndEvent_0q4qzl9'], 'outputs': ['End'], 'typename': '_EndJoin'}, 'End': {'id': 'empty_workflow_3', 'name': 'End', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['empty_workflow.EndJoin'], 'outputs': [], 'typename': 'Simple'}, 'StartEvent_1': {'id': 'empty_workflow_4', 'name': 'StartEvent_1', 'description': None, 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['Start'], 'outputs': ['EndEvent_0q4qzl9'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 179.0, 'y': 99.0}, 'outgoing_sequence_flows': {'EndEvent_0q4qzl9': {'id': 'SequenceFlow_0lvudp8', 'name': None, 'documentation': None, 'target_task_spec': 'EndEvent_0q4qzl9', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'SequenceFlow_0lvudp8': {'id': 'SequenceFlow_0lvudp8', 'name': None, 'documentation': None, 'target_task_spec': 'EndEvent_0q4qzl9', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'StartEvent', 'extensions': {}}, 'EndEvent_0q4qzl9': {'id': 'empty_workflow_5', 'name': 'EndEvent_0q4qzl9', 'description': None, 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': ['StartEvent_1'], 'outputs': ['empty_workflow.EndJoin'], 'lane': None, 'documentation': None, 'loopTask': False, 'position': {'x': 432.0, 'y': 99.0}, 'outgoing_sequence_flows': {'empty_workflow.EndJoin': {'id': 'EndEvent_0q4qzl9.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'empty_workflow.EndJoin', 'typename': 'SequenceFlow'}}, 'outgoing_sequence_flows_by_id': {'EndEvent_0q4qzl9.ToEndJoin': {'id': 'EndEvent_0q4qzl9.ToEndJoin', 'name': None, 'documentation': None, 'target_task_spec': 'empty_workflow.EndJoin', 'typename': 'SequenceFlow'}}, 'data_input_associations': [], 'data_output_associations': [], 'event_definition': {'internal': False, 'external': False, 'typename': 'NoneEventDefinition'}, 'typename': 'EndEvent', 'extensions': {}}, 'Root': {'id': 'empty_workflow_6', 'name': 'Root', 'description': '', 'manual': False, 'internal': False, 'lookahead': 2, 'inputs': [], 'outputs': [], 'typename': 'Simple'}}, 'data_inputs': [], 'data_outputs': [], 'data_objects': {}, 'correlation_keys': {}, 'typename': 'BpmnProcessSpec'}}, 'subprocesses': {}, 'bpmn_messages': []}

wf = serializer.workflow_from_dict(serialized)
wf.do_engine_steps()
print(wf.data)
